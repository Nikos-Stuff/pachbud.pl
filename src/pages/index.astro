---
// export const prerender = false;

import { getCollection } from "astro:content";
import PageLayout from "@layouts/PageLayout.astro";
import { SITE, SOCIALS } from "@consts";
import DynamicTitle from "@components/TitleHeader.astro";
import ArrowCard from "@components/ArrowCard";

import { Image } from "astro:assets";

import bud_2 from "@assets/bud_2.jpg";
import bud_3 from "@assets/bud_3.jpg";
import bud_4 from "@assets/bud_4.jpg";
import bud_5 from "@assets/bud_5.jpg";
import WhatWeDo from "@components/WhatWeDo.astro";

const posts = (await getCollection("blog"))
  .filter((post) => !post.data.draft)
  .sort((a, b) => {
    // Sort by date and time
    const dateA = new Date(a.data.date);
    const dateB = new Date(b.data.date);

    const timeA = a.data.time || "00:00";
    const timeB = b.data.time || "00:00";

    const dateTimeA = new Date(`${dateA.toDateString()} ${timeA}`);
    const dateTimeB = new Date(`${dateB.toDateString()} ${timeB}`);

    return dateTimeB.getTime() - dateTimeA.getTime();
  })
  .slice(0, 3);

const projects = (await getCollection("projects"))
  .filter((project) => !project.data.draft)
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
  .slice(0, 3);
---

<PageLayout title="Home" description={SITE.DESCRIPTION}>
  <div
    id="brick-bg"
    class="fixed top-0 left-0 w-screen h-screen bg-[url('/bricks.svg')] blur-xs bg-repeat bg-auto stroke-gray-600 dark:stroke-gray-400 invert saturate-0 opacity-10 pointer-events-none z-0 transition-all duration-500"
  >
  </div>

  <!-- HERO -->
  <section
    id="hero_fade"
    class="snap-center grid w-full h-svh place-items-center relative text-center transition-all md:p-10 md:pt-20"
  >
    <DynamicTitle
      text="PachBud"
      sub="Usługi Budowlane"
      buttons={true}
      typewriter={true}
    />
  </section>

  <div class="relative">
    <div
      class="animate tape flex justify-center items-center mb-5 h-[50px] w-full"
    >
    </div>
    <!-- Going full flexbox right here lol -->
    <div
      class="flex flex-col gap-12 md:gap-1 overflow-hidden py-5"
    >
      {/* Row 1 */}
      <div
        data-cursor-hover="true"
        data-cursor-parallax="true"
        class="animate relative group flex flex-col md:flex-row items-center justify-center gap-4 md:gap-8 overflow-hidden"
      >
        {/* Animated background span flowing over the image */}
        <span
          class="absolute top-0 left-[-50%] w-[0%] h-full bg-amber-700/50 dark:bg-amber-700/80 skew-x-[-20deg] transform transition-all duration-700 group-hover:w-[70%] z-10"
        ></span>

        {/* Image */}
        <div
          class="w-full md:flex-[0_0_50%] md:max-w-[50%] h-[20rem] md:h-[35rem] overflow-hidden"
        >
          <Image
            src={bud_2}
            alt="Show off 1"
            class="w-full h-full object-cover transition-all duration-500 md:group-hover:translate-x-2"
          />
        </div>

        {/* Text */}
        <div
          class="w-full md:w-1/2 text-center md:text-left p-4 md:p-8 relative z-20"
        >
          <h2
            class="text-2xl sm:text-3xl md:text-4xl font-bold mb-2 transition-transform duration-500 md:group-hover:translate-x-1"
          >
            Doświadczenie i <span class="text-amber-600">rzetelność</span>
          </h2>
          <p
            class="text-lg md:text-xl leading-relaxed tracking-wide text-gray-800 dark:text-gray-200
         relative after:content-[''] after:block after:w-0 after:h-[2px] after:bg-amber-600
         after:absolute after:bottom-0 after:left-0 after:transition-all after:duration-500
         group-hover:after:w-full"
          >
            Działamy od lat, realizując inwestycje budowlane z najwyższą
            starannością i zgodnie ze sztuką budowlaną.
          </p>
        </div>
      </div>

      {/* Row 2*/}
      <div
        data-cursor-hover="true"
        data-cursor-parallax="true"
        class="animate relative group flex flex-col md:flex-row-reverse items-center justify-center gap-4 md:gap-8 overflow-hidden"
      >
        {/* Animated background span */}
        <span
          class="absolute top-0 left-[-50%] w-[0%] h-full bg-amber-700/50 dark:bg-amber-700/80 skew-x-[-20deg] transform transition-all duration-700 group-hover:w-[70%] z-10"
        ></span>

        {/* Image */}
        <div
          class="w-full md:flex-[0_0_50%] md:max-w-[50%] h-[20rem] md:h-[35rem] overflow-hidden"
        >
          <Image
            src={bud_3}
            alt="Show off 2"
            class="w-full h-full object-cover transition-all duration-500 md:group-hover:-translate-x-2"
          />
        </div>
        {/* Text */}
        <div
          class="w-full md:w-1/2 text-center md:text-left p-4 md:p-8 relative z-20"
        >
          <h2
            class="text-2xl sm:text-3xl md:text-4xl font-bold mb-2 transition-transform duration-500 group-hover:translate-x-1"
          >
            Profesjonalna <span class="text-amber-600">obsługa</span>
          </h2>
          <p
            class="text-lg md:text-xl leading-relaxed tracking-wide text-gray-800 dark:text-gray-200
         relative after:content-[''] after:block after:w-0 after:h-[2px] after:bg-amber-600
         after:absolute after:bottom-0 after:left-0 after:transition-all after:duration-500
         group-hover:after:w-full"
          >
            Zapewniamy pełne wsparcie na każdym etapie inwestycji, aby każdy
            projekt zakończył się sukcesem.
          </p>
        </div>
      </div>

      {/* Row 3 */}
      <div
        data-cursor-hover="true"
        data-cursor-parallax="true"
        class="animate relative group flex flex-col md:flex-row items-center justify-center gap-4 md:gap-8 overflow-hidden"
      >
        {/* Animated background span flowing over the image */}
        <span
          class="absolute top-0 left-[-50%] w-[0%] h-full bg-amber-700/50 dark:bg-amber-700/80 skew-x-[-20deg] transform transition-all duration-700 group-hover:w-[70%] z-10"
        ></span>

        {/* Image */}
        <div
          class="w-full md:flex-[0_0_50%] md:max-w-[50%] h-[20rem] md:h-[35rem] overflow-hidden"
        >
          <Image
            src={bud_5}
            alt="Show off 3"
            class="w-full h-full object-cover transition-all duration-500 md:group-hover:translate-x-2"
          />
        </div>

        {/* Text */}
        <div
          class="w-full md:w-1/2 text-center md:text-left p-4 md:p-8 relative z-20"
        >
          <h2
            class="text-2xl sm:text-3xl md:text-4xl font-bold mb-2 transition-transform duration-500 md:group-hover:translate-x-1"
          >
            <span class="text-amber-600">Zadowolenie</span> klientów
          </h2>
          <p
            class="text-lg md:text-xl leading-relaxed tracking-wide text-gray-800 dark:text-gray-200
         relative after:content-[''] after:block after:w-0 after:h-[2px] after:bg-amber-600
         after:absolute after:bottom-0 after:left-0 after:transition-all after:duration-500
         group-hover:after:w-full"
          >
            Najlepszą wizytówką są nasi zadowoleni klienci. Działamy uczciwie,
            słuchamy potrzeb i budujemy zaufanie.
          </p>
        </div>
      </div>

      {/* Row 4*/}
      <div
        data-cursor-hover="true"
        data-cursor-parallax="true"
        class="animate relative group flex flex-col md:flex-row-reverse items-center justify-center gap-4 md:gap-8 overflow-hidden"
      >
        {/* Animated background span */}
        <span
          class="absolute top-0 left-[-50%] w-[0%] h-full bg-amber-700/50 dark:bg-amber-700/80 skew-x-[-20deg] transform transition-all duration-700 group-hover:w-[70%] z-10"
        ></span>

        {/* Image */}
        <div
          class="w-full md:flex-[0_0_50%] md:max-w-[50%] h-[20rem] md:h-[35rem] overflow-hidden"
        >
          <Image
            src={bud_4}
            alt="Show off 4"
            class="w-full h-full object-cover transition-all duration-500 md:group-hover:-translate-x-2"
          />
        </div>

        {/* Text */}
        <div
          class="w-full md:w-1/2 text-center md:text-left p-4 md:p-8 relative z-20"
        >
          <h2
            class="text-2xl sm:text-3xl md:text-4xl font-bold mb-2 transition-transform duration-500 group-hover:translate-x-1 object-cover"
          >
            Terminowość i <span class="text-amber-600">rzetelność</span>
          </h2>
          <p
            class="text-lg md:text-xl leading-relaxed tracking-wide text-gray-800 dark:text-gray-200
         relative after:content-[''] after:block after:w-0 after:h-[2px] after:bg-amber-600
         after:absolute after:bottom-0 after:left-0 after:transition-all after:duration-500
         group-hover:after:w-full"
          >
            Szanujemy Twój czas i budżet – dotrzymujemy ustalonych terminów i
            zapewniamy przejrzyste warunki współpracy.
          </p>
        </div>
      </div>
    </div>

    <div
      class="animate tape flex justify-center items-center mb-5 mt-5 h-[50px] w-full"
    >
    </div>
    <!-- Some scrolling textes here -->
    <div class="animate text-center h-55 backdrop-blur-md">
      <WhatWeDo />
    </div>

    <div
      class="animate tape flex justify-center items-center mb-5 mt-5 h-[50px] w-full"
    >
    </div>

    <section class="animate md:p-10 relative">
      <div
        class="relative h-full w-full
           bg-[linear-gradient(121deg,_#FF4D00_0%,_#5c0801_100%)]
           backdrop-blur-md md:rounded-4xl p-4 flex flex-col items-center overflow-hidden"
      >
        <!-- Background big text -->
        <h1
          class="hidden md:block absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2
             text-[10rem] md:text-[15rem] lg:text-[20rem]
             font-extrabold uppercase text-black/10 dark:text-white/10 pointer-events-none select-none whitespace-nowrap"
        >
          BLOG
        </h1>

        <ul
          class="flex flex-col md:flex-row md:flex-wrap gap-4 justify-center items-center w-full max-w-[1200px] relative z-10"
        >
          {
            posts.map((post) => (
              <li class="flex-1 min-w-[100%]">
                <ArrowCard entry={post} />
              </li>
            ))
          }
        </ul>
      </div>
    </section>
    <section class="animate pt-10 md:p-10 md:pt-0 relative">
      <div
        class="relative h-full w-full
           bg-[linear-gradient(121deg,_#FF4D00_0%,_#5c0801_100%)]
           backdrop-blur-md md:rounded-4xl p-4 flex flex-col items-center overflow-hidden"
      >
        <!-- Background big text -->
        <h1
          class="hidden md:block absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2
             text-[10rem] md:text-[15rem] lg:text-[20rem]
             font-extrabold uppercase text-black/10 dark:text-white/10 pointer-events-none select-none whitespace-nowrap"
        >
          WORK
        </h1>

        <ul
          class="flex flex-col md:flex-row md:flex-wrap gap-4 justify-center items-center w-full max-w-[1200px] relative z-10"
        >
          {
            projects.map((project) => (
              <li class="flex-1 min-w-[100%]">
                <ArrowCard entry={project} />
              </li>
            ))
          }
        </ul>
      </div>
    </section>
  </div>
</PageLayout>
